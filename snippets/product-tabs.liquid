{% assign combine_pretext = false %}

{% if description contains "<h6>" %}
	{% assign tab_heads = '' %}
	{% assign tab_texts = '' %}
	{% assign pretext = '' %}

	{% assign chunks = description | strip | split: "<h6>" %}
	{% for c in chunks %}
		{% if c contains "</h6>" %}
			{% assign chunk = c | split: "</h6>" %}
			{% assign head = chunk.first | strip %}
			{% if head == blank %}
				{% continue %}
			{% endif %}
			{% assign tab_heads = tab_heads | append: ",," | append: chunk.first %}
			{% assign tab_texts = tab_texts | append: ",," %}
			{% if pretext != blank  and combine_pretext %}
				{% assign tab_texts = tab_texts | append: pretext | append: "<br>" %}
				{% assign pretext = '' %}
			{% endif %}
			{% assign tab_texts = tab_texts | append: chunk.last  %}
		{% elsif forloop.first %}
			{% assign pretext =  c %}
		{% endif %}
	{% endfor %}

	{% assign tab_heads = tab_heads | remove_first: ",," | split: ",," %}
	{% assign tab_texts = tab_texts | remove_first: ",," | split: ",," %}


{% if pretext %}
      <div class="product__description rte">
        {{ pretext }}
      </div>
	{% endif %}

	{% for head in tab_heads %}
            <div class="product__accordion accordion" {{ block.shopify_attributes }}>
<!-- {{ forloop.first | json }} -- {{ block | json }} -->              
              <details {% if forloop.first and block.settings.open %} open {% endif %} >
                <summary>
                  <div class="summary__title">
                    <h2 class="h4 accordion__title">
                      {{ head }}
                    </h2>
                  </div>
                  {% render 'icon-caret' %}
                </summary>
                <div class="accordion__content rte">
                  {{ tab_texts[forloop.index0] }}
                </div>
              </details>
            </div>
	{% endfor %}
{% else %}
  <div class="product__description rte">
    {{ description }}
  </div>
{% endif %}